# V22 - Tween-Based Movement Exploitation

## Severity: MEDIUM

## Summary
Server uses TweenService to move players/enemies to target positions, but doesn't validate that the tween completes correctly or that the final position is valid. Attackers can intercept or manipulate tween targets to teleport to invalid locations.

## Vulnerability Details

### Root Cause
TweenService tweens are created for player/enemy movement, but the target CFrame/Position is often derived from client data. Additionally, tween completion isn't always verified.

### Affected Code Pattern
```lua
-- ConsumeModule_ID118.luau:137-140
local any_Create_result1_2 = TweenService_upvr:Create(
    var28_upvw.HumanoidRootPart,
    TweenInfo.new(1),
    {
        CFrame = var28_upvw.HumanoidRootPart.CFrame + Vector3.new(0, 50, 0);
    }
)
any_Create_result1_2:Play()

-- Target position can be manipulated before tween starts
-- Tween completion assumed but not verified
```

### Attack Vector
1. Intercept TweenService:Create calls
2. Modify the target CFrame/Position in the property table
3. Tween moves player to attacker-specified location
4. Or: Cancel tweens mid-execution to freeze at advantageous positions

## Impact
- Teleport to arbitrary locations during skills
- Escape combos by modifying tween targets
- Reach inaccessible map areas
- Desync between expected and actual position

## Affected Files
| File | Line | Tween Usage |
|------|------|-------------|
| ConsumeModule_ID118.luau | 137-140 | HumanoidRootPart tween |
| BladeStormModule_ID98.luau | 160-163 | Part transparency/size tween |
| Client_ID100.luau | 30 | BodyVelocity tween |
| Client_ID69.luau | 30 | BodyVelocity tween |
| AerialSmiteModule_ID148.luau | 92-93 | VFX position tween |
| Multiple modules | Various | TweenService:Create patterns |

## Proof of Concept
See `poc.luau` in this folder.

## Remediation
```lua
-- Validate tween targets server-side
local function safeTween(target, tweenInfo, properties)
    -- Validate CFrame targets
    if properties.CFrame then
        local targetPos = properties.CFrame.Position
        local currentPos = target.Position

        -- Check if movement is within allowed bounds
        local MAX_TWEEN_DISTANCE = 100
        if (targetPos - currentPos).Magnitude > MAX_TWEEN_DISTANCE then
            warn("Tween target too far, clamping")
            local direction = (targetPos - currentPos).Unit
            properties.CFrame = CFrame.new(currentPos + direction * MAX_TWEEN_DISTANCE)
        end
    end

    -- Create and track tween
    local tween = TweenService:Create(target, tweenInfo, properties)

    -- Verify completion
    tween.Completed:Connect(function(playbackState)
        if playbackState ~= Enum.PlaybackState.Completed then
            -- Tween was cancelled, reset to valid state
            target.CFrame = lastValidCFrame
        end
    end)

    return tween
end
```

## References
- CWE-807: Reliance on Untrusted Inputs in a Security Decision
- Game Security: Movement Validation
