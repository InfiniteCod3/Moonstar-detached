--[[
    V22 - Tween-Based Movement Exploitation
    Proof of Concept Exploit

    This exploit manipulates TweenService to teleport to arbitrary
    locations or freeze movement at advantageous positions.
]]

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Store original TweenService:Create
local originalCreate = TweenService.Create

-- Hook TweenService to modify tween targets
local function hookTweenService(targetOverride)
    TweenService.Create = function(self, instance, tweenInfo, properties)
        -- Check if this is a character movement tween
        if instance:IsA("BasePart") and instance.Name == "HumanoidRootPart" then
            -- Modify the target position
            if properties.CFrame then
                properties.CFrame = CFrame.new(targetOverride)
            elseif properties.Position then
                properties.Position = targetOverride
            end
        end

        return originalCreate(self, instance, tweenInfo, properties)
    end
end

-- Restore original TweenService
local function restoreTweenService()
    TweenService.Create = originalCreate
end

-- Teleport anywhere during a skill
local function tweenTeleport(targetPosition)
    local char = LocalPlayer.Character
    if not char then return end

    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- Hook to redirect next tween
    hookTweenService(targetPosition)

    -- Wait for skill to trigger tween, then restore
    task.delay(2, restoreTweenService)
end

-- Cancel tweens to freeze at current position
local function freezeTween()
    local char = LocalPlayer.Character
    if not char then return end

    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- Hook to cancel tweens immediately
    TweenService.Create = function(self, instance, tweenInfo, properties)
        local tween = originalCreate(self, instance, tweenInfo, properties)

        -- Immediately cancel if it's moving our character
        if instance:IsDescendantOf(char) then
            task.defer(function()
                tween:Cancel()
            end)
        end

        return tween
    end
end

-- Modify tween to move to safe location (out of combat area)
local function escapeCombat()
    local char = LocalPlayer.Character
    if not char then return end

    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- Find a safe location (spawn point or out of bounds)
    local safeLocation = Vector3.new(0, 1000, 0) -- High in sky

    hookTweenService(safeLocation)
end

-- Speed up tweens for faster skill execution
local function speedUpTweens()
    TweenService.Create = function(self, instance, tweenInfo, properties)
        -- Create faster tween info
        local fastTweenInfo = TweenInfo.new(
            tweenInfo.Time / 10, -- 10x faster
            tweenInfo.EasingStyle,
            tweenInfo.EasingDirection,
            tweenInfo.RepeatCount,
            tweenInfo.Reverses,
            tweenInfo.DelayTime
        )

        return originalCreate(self, instance, fastTweenInfo, properties)
    end
end

return {
    hookTweenService = hookTweenService,
    restoreTweenService = restoreTweenService,
    tweenTeleport = tweenTeleport,
    freezeTween = freezeTween,
    escapeCombat = escapeCombat,
    speedUpTweens = speedUpTweens
}
